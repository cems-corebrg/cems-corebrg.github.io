<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>CeMS Topology</title>
        <style>

@import "/css/fa.css";

body {
    font-family: "맑은 고딕", arial, tahoma;
	font-size: 10pt;
    position: fixed; top: 0; right: 0; bottom: 0; left: 0;
    padding: 0; margin: 0;
    display: flex;
}

main {
    flex: 1;
    position: relative;
}

iframe {
    width: 100%; height: 100%;
    border: none;
}

#dialog {
	position: fixed; top: 0; right: 0; bottom: 0; left: 0;
	padding: 0; margin: 0;
}

nav {
    position: absolute; top: 5px; right: 5px;
    user-select: none;
}

nav >span {
    font: 20px "Font Awesome 5 Free";
    border-radius: 50%;
    display: inline-flex; width: 32px; height: 32px;
    align-items: center;
    justify-content: center;
    background-color: rgba(0, 132, 255, 0.5);
    border-color: #0084ff;
    color: #ffffff;
    cursor: pointer;
}

nav >span:hover {
    background-color: #0084ff;
}

body:not(.edit) #close,
body.edit #edit,
body.frame nav,
body:not(.root) nav,
body:not(.dialog) #dialog {
    display: none;
}

			</style>            
        </head>
        
        <script>

function showDialog(src) {
    const dialog = document.getElementById("dialog");

    dialog.onload = function () {
		document.body.classList.add("dialog");
	};

    dialog.src = src;
}

function closeDialog(reset) {
    document.body.classList.remove("dialog");
    
    if (reset) {
        resetDialog();
    }
}

function resetDialog() {
    document.getElementById("frame").contentWindow.location.reload();
}

function showChart(id) {
    const popup = window.open();

    popup.sessionStorage.setItem("id", id);

    if (arguments.length === 3) {
        popup.sessionStorage.setItem("chart", arguments[1]);
        popup.sessionStorage.setItem("index", arguments[2]);
    }
        
    popup.location.replace("/chart.html");
}

function getPositionData() {
    return $.positionData;
}

function showMessage(xhr) {
    switch (xhr.status) {
    case 401:
        alert(NOTICE_SESS_EXPIRE["kr"]);

        break;
    default:
        alert(ERROR_RES_CODE(xhr.status)["kr"]);
    }

    try {
        console.log(JSON.parse(xhr.responseText).error);
    } catch (e) {}
}

        </script>

        <body>
            <main>
                <iframe id="frame"></iframe>
            </main>
            <nav>
                <span id="close" title="편집 종료">
                    &#xf00d;
                </span>
                <span id="edit" title="편집 모드">
                    &#xf013;
                </span>
            </nav>
            <iframe id="dialog"></iframe>

        <script>
if (opener && opener.account) {
    window.account = JSON.parse(JSON.stringify(opener.account));
} else if (top !== window && top.account) {
    window.account = JSON.parse(JSON.stringify(top.account));

    document.body.classList.add("frame");
} else {
    throw window.location.replace("/warning.html");
}

if (window.account.level === 0) {
    document.body.classList.add("root");
}

        </script>
        <script src="/js/request.js"></script>
        <script src="/js/constants.js"></script>
        <script>

const $ = {
        request: new Request()
    };

document.getElementById("edit").onclick = e => {
    document.body.classList.toggle("edit");

    document.getElementById("frame").contentWindow.location.replace("/topology/edit.html");
};

document.getElementById("close").onclick = e => {
    document.body.classList.toggle("edit");

    document.getElementById("frame").contentWindow.location.replace("/topology/view.html");
};


$.request.execute({
    command: "get",
    target: "position",
    name: "position"
}, function (e) {
    switch(this.status) {
    case 200:
        $.positionData = JSON.parse(this.responseText);
        
        document.getElementById("frame").src = "/topology/view.html";
        
        break;
    default:
        showMessage(this);
    }
});

        </script>
    </body>
</html>