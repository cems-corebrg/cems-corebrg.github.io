<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Cache-Control" content="No-Cache">
		
		<title>Summary</title>

		<style>
@import "/css/style.css";
@import "/css/var.css";
@import "/css/fa.css";

:root {
    --container-height: 120px;
}

body {
	color: #fff;
}

article {
    page-break-inside: avoid;
	display: flex;
	justify-content: space-between;
	flex-wrap: wrap;
}

h2 {
    margin: 0 0 0.5em 0;
    background-color: #777;
    border-radius: 5px 5px 0 0;
    padding: 0.5em;
	text-align: center;
    text-shadow: 0 2px 3px #000;
}

iframe {
    border: none;
    width: 100%; height: 100%;
}

section {
    position: relative;
	padding: 5px;
	background-color: #424242;
    box-sizing: border-box;
    margin: 3px 0;
}

section.event {
    flex: 400px 1;
}

section.event:has(tbody:empty) {
    display: none;
}

section.event .container {
    overflow-y: auto;
}

section.event .shutdown {
    color: var(--var-color-shutdown);
}

section.event .critical {
    color: var(--var-color-critical);
}

section.event .major {
    color: var(--var-color-major);
}

section.dummy {
    flex: 1;
}

.container {
    /*height: 120px;*/
    box-sizing: border-box;
    width: var(--var-width, unset);
}

section.interface:not(:has(.switch :checked)) {
    position: relative;
    width: 100%;
}

section.interface .container2 {
    flex-wrap: nowrap;
    align-items: center;
    overflow-x: auto;
}

section.interface:has(.switch :checked) .container2 {
    flex-wrap: wrap;
    height: auto;
    overflow-x: hidden;
}

section.interface .container li label {
    position: absolute; top: 0; right: 0;
    display: none;
    cursor: pointer;
}

section.interface .container li.error label {
    color: #ff0000;
    display: initial;
}

section.interface .container li:hover label {
    display: initial;
}

section.interface select {
    position: absolute; inset: 10px auto auto 10px;
    padding: 0.5em;
}

section.information {
    flex: 1 0;
}

ul {
	list-style: none;
	margin: 0; padding: 0;
}

section.information table {
	border-collapse: collapse;
	width: 100%; min-width: 300px;
	table-layout: fixed;
}

section.information th {
	text-align: right;
    font-weight: bold;
	width: 80px;
}

td, th { 
	text-align: left;
	white-space: nowrap;
	text-overflow: ellipsis;
	overflow: hidden;
}

section.information th,
section.information td {
	padding: 3px 1em;
}

div.flex {
	display: flex;
}

div.flex span {
	flex: 1;
}

div.error {
    position: fixed; inset: 0 0 0 0;
    padding: 1em;
    pointer-events: none;
    background-color: #0000007f;
    font-size: 2em;
    color: #ffffff;
    font-weight: bold;
}

div.error::before {
    font-family: "Font Awesome 5 Free";
    content: "\f06a";
}

div.error::after {
    content: attr(data-code);
}

dialog {
    width: 80%; height: 80%;
    overflow: hidden;
    background-color: rgba(0, 0, 0, 0.8);
    border: 2px ridge #ffffff;
}

dialog::backdrop {
    background-color: rgba(0, 0, 0, 0.5);
}

body.loading article {
    opacity: 0;
}

#refresh {
    position: absolute; top: 10px; right: 10px;
    font: 24px "Font Awesome 5 Free";
    content: "\f2f1";
    opacity: 0.6;
}

#refresh:hover {
    opacity: 1;
}

#refresh:active {
    text-shadow: none;
    transform: translateY(2px);
}

/** new gauge **/
.container2 {
    display: flex; flex-wrap: wrap; align-self: stretch;
    border: 1px solid transparent;
}

.container2 .container__display {
    border: 1px solid transparent;
}

.container2:not(.summary) :is(
    .container__display--response,
    .container__display--load:not(.summary),
    .container__display--storage,
    .container__display--memory,
    .container__display--temperature,
    .container__display--interface,
    .container__content--setting):hover,
.container2.summary:hover {
    cursor: pointer;
    border: 1px dotted #ddd;
}
/** container **/

section li {
    height: 120px;
}

.container__content,
.container__display {
    position: relative;
    box-sizing: border-box;
}

.container__content--image {
    aspect-ratio: 1/1;
    background-size: contain;
    background-repeat: no-repeat;
    background-position: center;
}

.container__content--setting {
    font: 40px "Font Awesome 5 Free";
    display: flex; justify-content: center; align-items: center;
    aspect-ratio: 1/1;
}

/** response **/
.container__display--response {
    font: 30px "Font Awesome 5 Free";
    width: calc(var(--container-height) *4/3);
    background-color: #424242;
    color: #ffffff;
    overflow: hidden;
}

.container__display--response::before {
    position: absolute; inset: 0;
    content: "";
    clip-path: circle(38% at 50% 50%);
    background-image: linear-gradient(135deg, #dddddd 0%, #FE6A50 30%, #f6bf26 50%, #00897b 70%, #8e24aa 100%);
    animation: rotate 2s infinite;
}

.container__display--response::after {
    font-size: 24px;
    font-weight: bold;
    content: attr(data-value);
    clip-path: circle(35% at 50% 50%);
    position: absolute; inset: 0;
    background-color: inherit;
    display: flex; justify-content: center; align-items: center;
}

/** temperature **/
.container__display--temperature {
    width: calc(var(--container-height) *4/3);
}

.container__display--temperature {
    background: url("/img/thermometer.png") center no-repeat;
    background-size: 60%;
}

.container__display--temperature::before {
    font-size: 12px;
    content: attr(data-label);
    position: absolute; bottom: 5px;
}

.container__display--temperature::after {
    font-size: 24px;
    font-weight: bold;
    content: attr(data-value);
    position: absolute; inset: 0;
    display: flex; justify-content: center; align-items: center;
}

/** power **/
.container__display--power {
    width: calc(var(--container-height) *4/3);
}

.container__display--power::before {
    position: absolute; inset: 0;
    display: flex; justify-content: center; align-items: center;
    font: 100px "Font Awesome 5 Free";
    content: "\f1e6";
    background-image: linear-gradient(#c0c0c0, #c0c0c0 30%, #00897b 30%, #00897b 65%, #c0c0c0 65%, #c0c0c0 100%);
    background-size: 100% 200%;
    background-image: linear-gradient(#c0c0c0, #c0c0c0 65%, #00897b 65%, #00897b 100%);
    -webkit-background-clip: text;
    background-clip: text;
	-webkit-text-fill-color: transparent;
    animation: yflow 2s linear infinite;
}

.container__display--power::after {
    font-size: 12px;
    content: attr(data-label);
    position: absolute; bottom: 5px;
}

/** fan **/
.container__display--fan {
    width: var(--container-height);
    background: url(/img/fan.png) no-repeat center;
    background-size: contain;
    overflow: hidden;
}

.container__display--fan::before {
    position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font: 100px "Font Awesome 5 Free";
    content: "\f863";
    background-color: #00897b;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    animation: rotate2 2s linear infinite;
}

.container__display--fan::after {
    font-size: 12px;
    content: attr(data-label);
    position: absolute; bottom: 5px;
}

/** storage **/
.container__display--memory,
.container__display--storage {
    width: calc(var(--container-height) *2);
}

/** load **/
.container__display--load {
    width: calc(var(--container-height) *2);
}

.container__display--load::after {
    content: attr(data-name);
    display: block;
    text-align: center;
}

/** interface **/
.container__display--interface {
    flex: none;
    width: calc(var(--container-height) *2/3);
}

.container__display--interface:not(:hover) .container__label {
    display: none;
}

/** new gauge public**/
.container__label,
.container__status {
    position: absolute;
}

.container__label {
    top: 0; right: 0;
    color: #ff1818;
    opacity: 0.5;
}

.container__label:hover {
    opacity: 1;
}

.container__status {
    top: 12px; left: 12px;
    color: #aaff00;
}

.container__display--interface .container__status {
    top: 0; left: 0;
}

.container__icon {
    font: 30px "Font Awesome 5 Free";
}

.container2.summary .container__display:not(:first-child) .container__status {
    display: none;
}

.container__display--interface:not(.running) .container__status {
    display: none;
}

.container__display[data-match] .container__status {
    color: #fefe33;
    display: initial;
}

.container__display[data-critical] .container__status {
    color: #ffad00;
}

.container__display:is([data-match], [data-critical]) .container__status {
    animation: flash 1s infinite;
}

.container__display--response[data-critical]::before,
.container__display--fan[data-match]::before,
/*.container__display--temperature[data-critical]::before,*/
.container__display--power[data-match]::before {
    background-color: #8e24aa;
    background-image: none;
    animation: none;
}

body:not(.root) .root,
body:not(.error) .error,
section:has(.container2:empty),
section.load:not(:has(.switch)),
body.shutdown .status::after {
	display: none;
}

@keyframes rotate {
    0% {
        transform: rotate(0deg);
    }
    100% {
        transform: rotate(360deg);
    }
}

@keyframes rotate2 {
    0% {
        transform: translate(-50%, -50%) rotate(0deg);
    }
    100% {
        transform: translate(-50%, -50%) rotate(360deg);
    }
}

@keyframes yflow {
    0% {
        background-position-y: 0;
    }
    50% {
        background-position-y: 100%;
    }
    100% {
        background-position-y: 100%;
    }
}

@keyframes flash {
    0% {
        opacity: 1;
    }
    50% {
        opacity: 0;
    }
}
		</style>
        <script src="/util/gauge.js"></script>
        <script src="/util/ethernet.js"></script>
        <script src="/js/import/chart.js"></script>
		<script>

function onShowMIBDialog (e) {
    const dialog = document.body.querySelector("dialog");

    //dialog.querySelector("iframe").src = `/mib.html?node=${$.get("id")}&pen=${$.get("pen")}`;
    //dialog.querySelector("iframe").src = `/template.html?node=${$.get("id")}&pen=${$.get("pen")}`;

    dialog.showModal();
}

function onCloseDialog (e) {
    this.querySelector("iframe").contentWindow.document.body.classList.remove("dialog");

    this.close();
}

function onSetEnterprise (e) {
    if (!confirm("Confirm.\n\nEnterprise MIB 불러오기를 시도 하겠습니까?\n\n서버에 해당 정보가 업데이트 되어 있어야 합니다.")) {
        return;
    }

    document.body.classList.add("loading");

    $.get("request").query({
        command: "set",
        target: "mib",
        mib: {
            id: $.get("id"),
            pen: $.get("pen")
        }
    }).then( () => {
        setTimeout(() => window.requestAnimationFrame(t => window.location.reload()), 5000);

        alert("Information.\n\nSNMP 정보를 갱신하고 있습니다.");
    }).catch(showMessage);
}

function onReset(e) {
    if (!confirm("Confirm.\n\nSNMP 정보를 초기화 하겠습니까?\n\n주의! 새로고침이 아닙니다.\n정보 오류가 있는 경우 관리자가 실행할 수 있습니다.")) {
        return;
    }

    document.body.classList.add("loading");

    $.get("request").query({
            command: "remove",
            target: "resource",
            resource: {
                id: $.get("id")
            }
        }).then( () => {
            setTimeout(() => window.requestAnimationFrame(t => window.location.reload()), 5000);

            alert("Information.\n\nSNMP 정보를 갱신하고 있습니다.");
        }).catch(showMessage);
};

function showMessage(xhr) {
    if (xhr instanceof XMLHttpRequest) {
        switch (xhr.status) {
        case 401:
            alert(NOTICE_SESS_EXPIRE["kr"]);

            break;
        default:
            alert(ERROR_RES_CODE(xhr.status)["kr"]);
        }

        try {
            console.log(JSON.parse(xhr.responseText).error);
        } catch (e) {}
    } else if (xhr instanceof Error) {
        console.error(xhr);
    } else {
        console.trace();
    }
}

		</script>
	</head>

	<body class="loading">
		<article>
            <section>
                <h2>정보 공급자</h2>
                <ul class="container2">
                    <li id="enterprise" class="container__content container__content--image"></li>
                </ul>
            </section>
            
			<section class="information">
                <h2>
                    기본 정보
                    <span id="refresh" title="새로고침" class="root">&#xf2f1;</span>
                </h2>
                <ul class="container">
                    <li>
                        <table>
                            <tr>
                                <th>이름</th>
                                <td class="node name"></td>
                            </tr>
                            <tr>
                                <th>IP 주소</th>
                                <td class="node ip"></td>
                            </tr>
                            <tr>
                                <th>SNMP 이름</th>
                                <td class="snmp name"></td>
                            </tr>
                            <tr>
                                <th>SNMP 설명</th>
                                <td class="snmp descr"></td>
                            </tr>
                        </table>
                    </li>
                </ul>
			</section>

            <section>
                <h2>종류</h2>
                <ul class="container2">
                    <li id="type" class="container__content container__content--image"></li>
                </ul>
            </section>

            <section class="load">
                <h2 class="container__setting">프로세서</h2>
                <ul class="container2"><li class="container__display container__display--load">
                        <span class="container__status container__icon">&#xf3fd;</span>
                    </li></ul>
            </section>

            <section class="load">
                <label class="switch">
                    <input type="checkbox">
                    <span class="switch__toggle"></span>
                </label>
                <h2 class="container__setting">프로세서</h2>
                <ul class="container2 summary"><li class="container__display container__display--load">
                        <span class="container__status container__icon">&#xf3fd;</span>
                    </li></ul>
            </section>

            <section class="memory">
                <h2>메모리</h2>
                <ul class="container2"><li class="container__display container__display--memory">
                        <span class="container__status container__icon">&#xf7c2;</span>
                    </li></ul>
            </section>

            <section class="storage">
                <h2>스토리지</h2>
                <ul class="container2"><li class="container__display container__display--storage">
                        <span class="container__status container__icon">&#xf1c0;</span>
                    </li></ul>
            </section>

            <section class="response">
                <h2>응답 시간</h2>
                <ul class="container2"><li class="container__display container__display--response">
                        <span class="container__status container__icon">&#xf2f2;</span>
                    </li></ul>
            </section>
            
            <section class="temperature">
                <h2>온도</h2>
                <ul class="container2"><li class="container__display container__display--temperature">
                        <span class="container__status container__icon">&#xf76b;</span>
                    </li></ul>
            </section>

            <section class="power">
                <h2>전원</h2>
                <ul class="container2"><li class="container__display container__display--power">
                        <span class="container__status container__icon">&#xf0e7;</span>
                    </li></ul>
            </section>

            <section class="fan">
                <h2 class="container__setting">팬</h2>
                <ul class="container2"><li class="container__display container__display--fan">
                        <span class="container__status container__icon">&#xf011;</span>
                    </li></ul>
            </section>

            <section class="event">
                <h2>이벤트</h2>
                <ul class="container">
                    <li>
                        <table>
                            <!--colgroup>
                                <col width="100">
                            </colgroup-->
                            <tbody></tbody>
                        </table>
                    </li>
                </ul>
            </section>

            <section class="setting root">
                <h2>설정</h2>
                <ul class="container2">
                    <!--li class="container__content container__content--setting" id="mib" title="MIB 관리">&#xf013;</li-->
                    <li class="container__content container__content--setting" id="mib" title="MIB 마법사">&#xf0d0;</li-->
                    <li class="container__content container__content--setting" id="reset" title="데이터 초기화">&#xf829;</li>
                </ul>
            </section>

            <section class="dummy">
            </section>

            <section class="interface">
                <select></select>
                <label class="switch">
                    <input type="checkbox">
                    <span class="switch__toggle"></span>
                </label>
				<h2>
                    인터페이스
                </h2>
                    <ul class="container2"><li class="container__display container__display--interface">
                            <span class="container__status container__icon">&#xf796;</span>
                            <span class="container__label container__icon">&#xf071;</span>
                        </li></ul>
			</section>

		</article>

        <div class="error">
            SNMP 오류코드 : 
        </div>

        <dialog>
            <iframe></iframe>
        </dialog>

		<div class="loading mask"></div>
	
		<script src="/js/ITAhM.js"></script>
        <script src="/js/icon.js"></script>
        <script src="/js/snmp.js"></script>
        <script src="/js/request.js"></script>
        <script src="/js/constants.js"></script>
        <script src="/js/snmp.js"></script>
        <script src="/util/loader.js"></script>
		<script type="module">

import Display, {Response, Load, Summary, Storage, Temperature, Power, Fan, Interface} from "../../js/module/display.js";
import Channel from "../../js/module/channel.js";
import Message from "../../js/module/message.js";

const
    search = new URLSearchParams(window.location.search),
    id = Number(search.get("id"));
var display;

if (!id) {
    throw alert(ERROR_WRONG_ACCESS["kr"]);
}

window.$ = new Map();

$.set("id", id);
$.set("request", new Request());

document.body.querySelector("dialog").onclick = onCloseDialog;
document.getElementById("refresh").onclick = e => window.location.reload();

{
    let draggable;

    Array.from(document.body.querySelectorAll("section")).forEach(section => {
        section.draggable = true;
        
        section.addEventListener("dragstart", function (e) {
            e.stopPropagation();
            
            draggable = this;
        });
        
        section.addEventListener("dragover", function (e) {
            e.preventDefault();
            
            if (draggable === this) {
                return;
            }
            
            switch (draggable) {
            case this.previousElementSibling:
                this.parentNode.insertBefore(this, draggable);
                
                break;
            default:
                this.parentNode.insertBefore(draggable, this);
            }
        });
    });
}

function onSelectTemplate (args) {
    const
        {template, oid, index, unit, max, alias} = args,
        date = new Date(),
        search = new URLSearchParams();
    
    max && search.set("max", max);
    unit && search.set("unit", unit);
    alias && search.set("title", alias);

    search.set("id", $.get("id"));
    search.set("oid", oid);
    search.set("index", index);

    search.set("from", date.setHours(0, 0, 0, 0));
    search.set("to", date.setDate(date.getDate() +1));

    if (template instanceof Response) {
        search.set("name", "/chart/responseTime.html");
    } else if (template instanceof Load || template instanceof Summary) {
        search.set("name", "/chart/processor.html");
    } else if (template instanceof Storage) {
        search.set("name", "/chart/storage.html");
    } else if (template instanceof Temperature) {
        search.set("name", "/chart/enterprise/temperature.html");
    } else if (template instanceof Interface) {
        const {index, input, output, inerror, outerror, alias} = args;

        search.set("index", index);
        search.set("title", alias);

        if (input) {
            search.set("name", "/chart/throughput.html");
            search.set("input", encodeURIComponent(JSON.stringify(input)));
            search.set("output", encodeURIComponent(JSON.stringify(output)));
        } else if(inerror) {
            search.set("name", "/chart/error.html");
            search.set("input", encodeURIComponent(JSON.stringify(inerror)));
            search.set("output", encodeURIComponent(JSON.stringify(outerror)));
        } else {
            return;
        }
    }
    else {
        return;
    }

    window.location.replace(`/chart/chart.html?${search.toString()}`);
}

function refresh() {
    setTimeout(function () {
        $.get("request").query({
            command: "get",
            target: "node",
            node: {
                id: id,
                resource: true
            }
        }).then( node => {
            window.requestAnimationFrame(t => {
                document.body.classList["status" in node && !node.status? "remove": "add"]("shutdown");

                const reload = [
                    "response",
                    "load",
                    "memory",
                    "storage",
                    "temperature", 
                    "power",
                    "fan",
                    "input",
                    "output",
                    "inputhc",
                    "outputhc",
                    "astatus",
                    "ostatus"
                ].some(template => {
                    const resourceData = node.resource[template];

                    if (resourceData) {
                        loop: for (const oid in resourceData) {
                            for (const index in resourceData[oid]) {
                                try {
                                    display.update(resourceData[oid][index]);
                                } catch (e) {
                                    return true;
                                }
                            }
                        }
                    }
                });

                if (reload) {
                    alert("Information.\n\n자원 정보가 수정되었습니다.\n페이지를 새로고침 합니다.");
                                    
                    window.location.reload();
                } else {
                    display.animate();

                    refresh();
                }
            });
        }).catch(showMessage);
    }, 10000);
}

function onImageLoad() {
    let iconData = ITAhM.iconData;

    $.get("request").query({
        command: "get",
        target: "icon"
    }).then(data => {
        for (let key in data) {
            iconData[key] = data[key];
        }        

        return $.get("request").query({
            command: "get",
            target: "event",
            event: {
                node: id
            }
        });
    }).then(data => {
        const
            indexArray = Object.keys(data).sort(function (a, b) {
                return parseInt(a) - parseInt(b);
            }),
            df = document.createDocumentFragment(),
            container = document.body.querySelector("section.event .container");
            
        for (let i=0, _i=Math.min(indexArray.length, 99), item; i<_i; i++) {
                df.appendChild(
                    (event => {
                        const
                            message = new Message(event),
                            status = message.status,
                            tr = document.createElement("tr"),
                            span = tr.appendChild(document.createElement("td")).appendChild(document.createElement("span"));
                        
                        tr.dataset.id = event.id;

                        tr.appendChild(document.createElement("td")).textContent = message.date;
                        tr.appendChild(document.createElement("td")).textContent = message.time;
                        tr.appendChild(document.createElement("td")).textContent = event.message;

                        span.textContent = `${status.charAt(0).toUpperCase()}${status.slice(1)}`;

                        tr.classList.add(status);
                        
                        return tr;
                    })(data[indexArray[i]])
                );
            
        }
        
        container.querySelector("tbody").appendChild(df);

        container.scrollTop = container.scrollHeight;

        return $.get("request").query({
            command: "get",
            target: "node",
            node: {
                id: id,
                resource: true
            }
        });  
    }).then(node => {
        const nameToSelector = new Map();

        document.title = node.name || node.ip || "Summary";

        node.ip && (document.body.querySelector(".information .node.ip").textContent = node.ip);
        node.name && (document.body.querySelector(".information .node.name").textContent = node.name);

        {
            const type = document.getElementById("type");
            let icon = iconData["unknown"];
            
            if (node.type && node.type in iconData) {
                icon = iconData[node.type];
            }
        
            type.style.backgroundImage = `url(${icon.src})`;
            type.title = icon.type;
        }

        if ("snmp" in node && node.snmp !== 0) {
            document.body.classList.add("error");
            document.body.querySelector("div.error").dataset.code = node.snmp;
        }

        try {
            const system = node.resource.system;

            document.body.classList["status" in node && !node.status? "remove": "add"]("shutdown");

            document.body.querySelector(".information .snmp.name").textContent = system?.[ITAhM.snmp.oid.sysName]?.["0"].value ?? "";
            document.body.querySelector(".information .snmp.descr").textContent = system?.[ITAhM.snmp.oid.sysDescr]?.["0"].value ?? "";
            (sysObjectID => {
                if (sysObjectID) {
                    const enterprise = ITAhM.util.enterpriseFromOID(sysObjectID);

                    if (enterprise && enterprise.logo) {
                        document.getElementById("enterprise").style.backgroundImage = `url(${enterprise.logo})`;
                    } else {
                        document.getElementById("enterprise").title = sysObjectID;
                    }

                    $.set("pen", sysObjectID);
                }
            })(system?.[ITAhM.snmp.oid.sysObjectID]?.["0"].value);
        } catch (e) {
            if (confirm("Confirm.\n\nSNMP 정보를 불러오는데 문제가 있습니다.\n다시 시도하겠습니까?")) {
                window.location.reload();
            }

            throw e;
        }
        
        [
            "response",
            "load",
            "memory",
            "storage",
            "temperature",
            "power",
            "fan",
            "interface"
        ].forEach(name => nameToSelector.set(name, `.container__display--${name}`));
        
        Interface.image = this.map["/img/ethernet.png"];
        
        display = new Display(nameToSelector, onSelectTemplate);

        [
            "response",
            "load",
            "memory",
            "storage",
            "temperature", 
            "power",
            "fan",
            "interface",
            "input",
            "output",
            "inputhc",
            "outputhc",
            "inerror",
            "outerror"
        ].forEach(template => {
            const resourceData = node.resource[template];

            if (resourceData) {
                for (const oid in resourceData) {
                    for (const index in resourceData[oid]) {
                        display.add(resourceData[oid][index]);
                    }
                }
            }
        });
        
        // 복제 소스 삭제
        Array.from(document.body.querySelectorAll(".container2 .container__display:first-child"))
            .forEach(e => e.parentNode.removeChild(e));

        display.animate();

        // interface throughput
        {
            [
                "input",
                "output",
                "inputhc",
                "outputhc",
                "astatus",
                "ostatus"
            ].forEach(template => {
                const resourceData = node.resource[template];
                
                if (resourceData) {
                    for (const oid in resourceData) {
                        for (const index in resourceData[oid]) {
                            display.update(resourceData[oid][index]);
                        }
                    }
                }
            });
        }
        // interface type 별 분류
        {
            const 
                select = document.body.querySelector("section.interface select"),
                df = document.createDocumentFragment(),
                typeToInterfaceArray = new Map();
            let option;

            Array.from(document.body.querySelectorAll(".container2 .container__display--interface"))
                .forEach(e => {
                    let interfaceArray = typeToInterfaceArray.get(e.dataset.type);

                    if (!interfaceArray) {
                        typeToInterfaceArray.set(e.dataset.type, interfaceArray = []);
                    }

                    interfaceArray.push(e);
                });
            
            for (let type of typeToInterfaceArray.keys()) {
                option = document.createElement("option");
                option.text = ITAhM.snmp.ifType[type];
                option.value = type;
                
                df.appendChild (option);
            }

            select.appendChild (df);

            select.onchange = function filter () {
                const
                    cache = document.createDocumentFragment(),
                    type = select.value;

                Array.from(df.children)
                    .forEach(e => (e.dataset.type === type && cache.appendChild(e)));
                
                Array.from(document.body.querySelectorAll(".container2 .container__display--interface"))
                    .forEach(e => e.dataset.type !== type && df.appendChild(e));
                
                document.body.querySelector("section.interface ul").appendChild(cache);
            };

            select.value = "6";

            select.onchange();
        }
        
        refresh();
        
        document.body.classList.remove("loading");
    })
    .catch(showMessage);
}

Channel.request("account", account => {
    if (account.level === 0) {
        document.getElementById("mib").onclick = onSetEnterprise;
        document.getElementById("reset").onclick = onReset;

        document.body.classList.add("root");
    }

    Channel.request("config", config => {
        if (config.short.load) {
            document.body.querySelector("section.load").appendChild(document.body.querySelector(`section.load .switch`));

            document.body.querySelector("section.load .switch [type=checkbox]").checked = true;
        }

        if (config.short.interface) {
            document.body.querySelector(`section.interface .switch [type=checkbox]`).checked = true;
        }

        ["load", "interface"].forEach(name => {
            const checkbox = document.body.querySelector(`section.${name} .switch [type=checkbox]`);

            checkbox.onclick = e => {
                config.short[name] = !config.short[name];
                
                Channel.send("update", config);

                window.location.reload();
            }
        });

        new ImageLoader(onImageLoad).load(["/img/ethernet.png"]);
    });
});

		</script>
	
	</body>
</html>