<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta http-equiv="Cache-Control" content="No-Cache">
		
		<title>CeMS Chart</title>

		<style>

body {
    position: fixed; top: 0; right: 0; bottom: 0; left: 0;
    padding: 0; margin: 0;
	background-color: #4d525a;
}

iframe {
    width: 100%; height: 100%;
    padding: 0; margin: 0;
    border: none;
}

		</style>
		
		<script>

function showMessage(xhr) {
    switch (xhr.status) {
    case 401:
        alert(NOTICE_SESS_EXPIRE["kr"]);

        break;
    default:
        alert(ERROR_RES_CODE(xhr.status)["kr"]);
    }

    try {
        console.log(JSON.parse(xhr.responseText).error);
    } catch (e) {}
}

		</script>
	</head>

	<body>
        <iframe></iframe>

        <script src="/js/request.js"></script>
        <script src="/js/constants.js"></script>
		<script>

const $ = {
        request: new Request(),
        id: Number(window.sessionStorage.getItem("id")),
        chart: window.sessionStorage.getItem("chart"),
        index: window.sessionStorage.getItem("index")
    };

if (window === top) {
    if (!$.request.try(function (e) {
        if (this.status === 200) {
            window.account = JSON.parse(this.responseText);
        } else {
            throw window.location.replace("/warning.html");    
        }
    })) {
        throw window.location.replace("/warning.html");
    }
} else if (top.account) {
    window.account = JSON.parse(JSON.stringify(top.account));

    document.body.classList.add("frame");
} else {
    throw window.location.replace("/warning.html");
}

if ($.id) {
    $.request.execute({
        command: "get",
        target: "node",
		id: $.id,
		resource: true
	}, function () {
		switch (this.status) {
        case 200:
            break;
        default:
            return showMessage(this);
		}

        const node = JSON.parse(this.responseText);
                
        document.title = node.name || node.ip || "Chart";
        
        if ($.chart && $.index) {
            const date = new Date();

            window.sessionStorage.removeItem("chart");
            window.sessionStorage.removeItem("index");

            document.querySelector("iframe").src
                = `/chart/chart.html?id=${$.id}&index=${$.index}&name=${$.chart}&from=${date.setHours(0, 0, 0, 0)}&to=${date.setDate(date.getDate() +1)}`;
        } else {
            document.querySelector("iframe").src = `/chart/summary.html?id=${$.id}`;
        }
	});	
} else {
    window.location.replace("/warning.html");
}

		</script>
	
	</body>
</html>